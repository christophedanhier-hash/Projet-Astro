<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simulateur Terre & Saisons</title>
    <style>
        html,body{width:100%;height:100%;margin:0;padding:0;overflow:hidden;background:#020205;font-family:sans-serif;color:#fff;touch-action:none}
        #ui-container{position:absolute;top:10px;left:10px;background:rgba(10,15,30,.85);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);z-index:10;backdrop-filter:blur(4px);max-width:240px;max-height:85vh;overflow-y:auto}
        h1{margin:0 0 10px;font-size:1rem;color:#4da8da;text-transform:uppercase}
        .control-group{margin-bottom:10px;display:flex;flex-direction:column;gap:5px}
        .btn-group{display:flex;gap:5px}
        button{background:#4da8da;color:#050510;border:none;padding:8px;border-radius:5px;cursor:pointer;font-weight:bold;width:100%; transition: 0.3s;}
        button:hover{background:#79c2ea}
        #toggle-ui-btn{background:#3a4a5a;color:#fff;margin-top:5px;width:100%}
        .info-box { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; font-size: 0.85rem; line-height: 1.4; border: 1px solid rgba(77,168,218,0.2); }
        .highlight { color: #4da8da; font-weight: bold; }
        canvas{display:block;width:100%;height:100%}
    </style>
</head>
<body>
    <div id="ui-container">
        <div id="ui-content">
            <h1>Terre & Saisons</h1>
            <div class="control-group">
                <div class="info-box">
                    <span class="highlight">Saison (Nord) :</span> <span id="season-display">-</span><br>
                    <span class="highlight">Inclinaison :</span> 23.44¬∞<br>
                    <span class="highlight">Jour de l'ann√©e :</span> <span id="day-display">-</span>
                </div>
            </div>
            <div class="control-group">
                <label style="font-size: 0.8rem;">Simulation Annuelle :</label>
                <input type="range" id="year-slider" min="0" max="365" step="1" value="80">
            </div>
            <div class="control-group">
                <div class="btn-group">
                    <button id="zoom-in-btn">üîç +</button>
                    <button id="zoom-out-btn">üîç -</button>
                </div>
            </div>
            <div class="control-group">
                <button id="anim-btn">‚èØÔ∏è Animation</button>
            </div>
            <div class="control-group">
                 <label style="font-size: 0.8rem; display:flex; align-items:center; gap:5px;">
                    <input type="checkbox" id="show-axis" checked> Afficher l'axe
                 </label>
            </div>
            
            <a href="index.html" style="text-decoration:none;"><button id="home-btn" style="background:#3a4a5a; color:#fff; margin-top:10px; width:100%">üè† Accueil</button></a>
            <div style="font-size: 0.7rem; color: #666; text-align: center; margin-top: 8px;">Version 1.2 (28/02/2026)</div>
        </div>
        <button id="toggle-ui-btn">üëÅÔ∏è Masquer l'interface</button>
    </div>

    <script type="module">
        import * as THREE from 'https://esm.sh/three@0.160.0';
        import { OrbitControls } from 'https://esm.sh/three@0.160.0/examples/jsm/controls/OrbitControls.js';

        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.set(0, 30, 60);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // Stars background
        const starGeo = new THREE.BufferGeometry();
        const starPos = [];
        for(let i=0; i<2000; i++) {
            const r = 400;
            const theta = Math.random() * Math.PI * 2;
            const phi = Math.acos(2 * Math.random() - 1);
            starPos.push(r*Math.sin(phi)*Math.cos(theta), r*Math.sin(phi)*Math.sin(theta), r*Math.cos(phi));
        }
        starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
        scene.add(new THREE.Points(starGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.8})));

        // Earth Group (Handles Tilt)
        const earthGroup = new THREE.Group();
        earthGroup.rotation.z = 23.44 * Math.PI / 180; // Axial tilt
        scene.add(earthGroup);

        // Earth Mesh
        const textureLoader = new THREE.TextureLoader();
        const CDN_URL = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/';
        
        const earthGeo = new THREE.SphereGeometry(10, 64, 64);
        const earthMat = new THREE.MeshStandardMaterial({ roughness: 0.8 });
        const earth = new THREE.Mesh(earthGeo, earthMat);
        earthGroup.add(earth);

        textureLoader.load(CDN_URL + 'earth_atmos_2048.jpg', (tex) => { 
            tex.colorSpace = THREE.SRGBColorSpace;
            earthMat.map = tex; 
            earthMat.needsUpdate = true; 
        });

        // Axis Line
        const axisGeo = new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(0, -15, 0), new THREE.Vector3(0, 15, 0)]);
        const axisMat = new THREE.LineBasicMaterial({ color: 0xff0000 });
        const axisLine = new THREE.Line(axisGeo, axisMat);
        earthGroup.add(axisLine);

        // Sun Light (Simulates seasons by moving around)
        const sunLight = new THREE.DirectionalLight(0xffffff, 2.5);
        scene.add(sunLight);
        scene.add(new THREE.AmbientLight(0x333333));

        // Logic
        const slider = document.getElementById('year-slider');
        const seasonDisplay = document.getElementById('season-display');
        const dayDisplay = document.getElementById('day-display');
        let isAnimating = false;

        function updateSunPosition() {
            const day = parseInt(slider.value);
            dayDisplay.innerText = day;
            
            // Calcul de la position du soleil pour simuler les saisons
            // Jour 172 (21 Juin) = Solstice d'√©t√© (Nord) -> Soleil √©claire le p√¥le Nord
            const angle = ((day - 172) / 365) * Math.PI * 2;
            const sunAngle = angle + Math.PI; 
            
            sunLight.position.x = Math.cos(sunAngle) * 100;
            sunLight.position.z = Math.sin(sunAngle) * 100;

            // Texte Saison
            if (day < 79 || day > 354) seasonDisplay.innerText = "Hiver";
            else if (day < 171) seasonDisplay.innerText = "Printemps";
            else if (day < 265) seasonDisplay.innerText = "√ât√©";
            else seasonDisplay.innerText = "Automne";
        }

        document.getElementById('anim-btn').addEventListener('click', () => {
            isAnimating = !isAnimating;
            document.getElementById('anim-btn').innerText = isAnimating ? "‚è∏Ô∏è Pause" : "‚èØÔ∏è Animation";
        });
        
        slider.addEventListener('input', updateSunPosition);
        document.getElementById('show-axis').addEventListener('change', (e) => axisLine.visible = e.target.checked);
        document.getElementById('zoom-in-btn').addEventListener('click', () => camera.position.multiplyScalar(0.9));
        document.getElementById('zoom-out-btn').addEventListener('click', () => camera.position.multiplyScalar(1.1));
        document.getElementById('toggle-ui-btn').addEventListener('click', () => {
            const ui = document.getElementById('ui-content');
            ui.style.display = ui.style.display === 'none' ? 'block' : 'none';
        });

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            earth.rotation.y += 0.005; // Rotation journali√®re
            if (isAnimating) {
                let val = parseFloat(slider.value) + 0.5;
                if (val > 365) val = 0;
                slider.value = val;
                updateSunPosition();
            }
            renderer.render(scene, camera);
        }
        updateSunPosition(); animate();
        window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
    </script>
</body>
</html>